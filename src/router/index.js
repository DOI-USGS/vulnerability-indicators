import { createRouter, createWebHistory } from 'vue-router';
import i18n, { setLocale } from './../i18n';
import VisualizationView from '../views/VisualizationView.vue';

const routes = [
  {
    path: '/:lang(en|es)?', // Optional dynamic language parameter
    name: 'VisualizationContent',
    component: VisualizationView,
    meta: {
      requiresLang: true, // Add a meta field to indicate language switching
    },
  },
  {
    path: '/:lang(en|es)?/index.html', // Handle direct navigation to index.html with language
    name: 'Index',
    component: VisualizationView,
    meta: {
      requiresLang: true,
    },
  },
];


const router = createRouter({
  history: createWebHistory(import.meta.env.BASE_URL),
  routes
})

// Global beforeEach guard for setting up the locale
router.beforeEach(async (to, from, next) => {
  const lang = to.params.lang || 'en'; // Default to 'en' if no language is provided

  // Set the i18n locale
  if (to.meta.requiresLang) {
    await setLocale(lang); // Asynchronously update the locale
  }

  next();
});

export default router;
