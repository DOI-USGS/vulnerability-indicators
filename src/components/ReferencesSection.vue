<template>
  <section id="references">
    <div class="text-container title-text">
      <h3>{{ text.title }}</h3>
    </div>
    <div class="text-container">
      <div v-for="reference in text.references" :key="reference.subTitle">
        <p>
          <span v-html="reference.authors" />,
          <span v-html="reference.year" />,
          <a :href="reference.link" target="_blank"><span v-html="reference.title" /></a
          ><span v-if="reference.type != ''">, </span><span v-html="reference.type" /><span
            v-if="reference.ref != ''"
            >, </span
          ><span v-html="reference.ref" />.
        </p>
        <br />
      </div>
    </div>
  </section>
</template>

<script>
import { useI18n } from 'vue-i18n';
import { ref, watch } from 'vue';

export default {
  name: 'ReferencesSection',
  setup() {
    const { locale } = useI18n();
    const text = ref({});

    const loadReferencesText = (lang) => {
      if (lang === 'es') {
        import('@/assets/text/referencesText_es.js')
          .then((module) => {
            text.value = module.default.referencesContent;
            sortReferences();
          })
          .catch((error) => console.error('Failed to load Spanish references:', error));
      } else {
        import('@/assets/text/referencesText_en.js')
          .then((module) => {
            text.value = module.default.referencesContent;
            sortReferences();
          })
          .catch((error) => console.error('Failed to load English references:', error));
      }
    };

    const sortReferences = () => {
      if (text.value.references && Array.isArray(text.value.references)) {
        text.value.references.sort((a, b) => a.authors.localeCompare(b.authors));
      }
    };

    // Initial load based on current language
    loadReferencesText(locale.value);

    // Watch for changes in the locale and update the references accordingly
    watch(locale, (newLocale) => {
      loadReferencesText(newLocale);
    });

    return {
      text
    };
  }
};
</script>

<style scoped lang="scss">

</style>
