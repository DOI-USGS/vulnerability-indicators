<template>
  <div id="title" class="text-container title-text">
    <h3 v-html="teamText.title" />
  </div>
  <div id="text1" class="text-container">
    <p v-html="teamText.paragraph1" />
  </div>
  <div class="chart-container">
    <div ref="chart" class="chart"></div>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue';
import * as d3 from 'd3';
import text from "../assets/text/text.js";

const teamText = text.components.teamText;

const props = defineProps({
  data: {
    type: Array,
    required: true,
    validator(value) {
      return value.every(
        item => 'name' in item && 'link' in item && 'image' in item
      );
    }
  }
});

const chart = ref(null);

onMounted(() => {
  const data = props.data;
  const width = 700;
  const height = 300;
  const radius = 100;

  const svg = d3
    .select(chart.value)
    .append('svg')
    .attr('width', width)
    .attr('height', height)
    .attr('viewBox', `0 0 ${width} ${height}`);

  const simulation = d3.forceSimulation(data)
    .force("center", d3.forceCenter(width / 2, height / 2))
    .force("charge", d3.forceManyBody().strength(30))
    .force("collision", d3.forceCollide().radius(radius + 5))
    .on("tick", ticked);

  const node = svg
    .selectAll("g")
    .data(data)
    .enter()
    .append("g")
    .on('click', function (event, d) {
      console.log('Clicked:', d.link); // Log to ensure click event is triggered
      window.open(d.link, '_blank');
    });

  node
    .append('clipPath')
    .attr('id', (d, i) => `clip-${i}`)
    .append('circle')
    .attr('r', radius);

  node
    .append('circle')
    .attr('r', radius)
    .attr('fill', 'black')
    .attr('stroke-width', '5px')
    .attr('clip-path', (d, i) => `url(#clip-${i})`)
    .on('mouseover', function (event, d) {
      d3.select(this).attr('fill', 'orange');
    })
    .on('mouseout', function (event, d) {
      d3.select(this).attr('fill', 'black');
    });

  node
    .append('image')
    .attr('xlink:href', d => d.image)
    .attr('width', radius * 2.1)
    .attr('height', radius * 2.1)
    .attr('x', -1.05*radius)
    .attr('y', -1.1*radius)
    .attr('clip-path', (d, i) => `url(#clip-${i})`);

    function ticked() {
      node.attr("transform", d => {
        d.x = Math.max(radius, Math.min(width - radius, d.x));
        d.y = Math.max(radius, Math.min(height - radius, d.y));
        return `translate(${d.x},${d.y})`;
      });
    }
});
</script>

<style scoped lang="scss">
.chart-container {
  display: flex;
  justify-content: center;
  align-items: center;
  height: auto;
  width: 100%;
}

.chart {
  width: 700px;
}

.text-container {
  min-width: 30vw;
  max-width: 70rem;
  margin: 0 auto 0 auto;
  padding: 1rem 1rem 1rem 0rem;
  left: 0;
  @media screen and (max-width: 600px) {
    max-width: 95vw;
    padding: 0.5rem;
  }
}

.title-text {
  width: 100%;
}
</style>
