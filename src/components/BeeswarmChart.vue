<template>
        <div id="chart-container">
        </div>
</template>
  
<script setup>
    import { onMounted, ref } from "vue";
    import * as d3 from 'd3';

    // global variables 
    const publicPath = import.meta.env.BASE_URL;
    let chartDimensions;
    let xScale;
    const focalColor = "#d66853";
    const defaultColor = "#7d4e57";

    const beeswarm = ref(null);
    const data = ref([]); 

    onMounted(() => {
        loadData().then(() => {
            if (data.value.length > 0) {
                console.log(data.value)
            createBeeswarmChart();
            }
        });
    });

    async function loadData() {
        data.value = await d3.csv(publicPath + 'indicator_uncertainty.csv', d => {
            d.level_agreement = +d.level_agreement; 
            return d;
        });
        }

    function createBeeswarmChart() {
        // ... SVG setup ...
        const width = 1000; // Set your width
        const height = 800; // Set your height
        const radius = 4; // Set your circle radius
        const margin = { top: 20, right: 20, bottom: 20, left: 20 };


        const svg = d3.select("#chart-container")
                        .append('svg')
                        .attr('width', width)
                        .attr('height', height);

        // Define scales and axes
        const categories = Array.from(new Set(data.value.map(d => d.dimension))); // Unique categories
        const colorScale = d3.scaleOrdinal(d3.schemeDark2)
            .domain(categories)
        // to manually select the colors
            //const colorScale = d3.scaleOrdinal()
        //    .domain(['category1', 'category2', 'category3', ...])
        //    .range(['#1f77b4', '#ff7f0e', '#2ca02c', ...]); // Using the set of distinct colors



        const radiusScale = d3.scaleLinear()
            .domain([d3.min(data.value, d => d.evidence_val), d3.max(data.value, d => d.evidence_val)])
            .range([15, 20]);

        const yScale = d3.scaleLinear()
            .domain([d3.min(data.value, d => d.level_agreement), d3.max(data.value, d => d.level_agreement)])
            .range([height - margin.bottom, margin.top]);

        const yAxis = d3.axisLeft(yScale).ticks(5);

        // Append axes to SVG
        svg.append("g")
            .attr("transform", `translate(${margin.left*5}, 0)`)
            .call(yAxis);

            // Assuming your existing y-axis is created and appended to the SVG

        // Add Y-axis label
        svg.append("text")
        .attr("transform", "rotate(0)") // Rotates the text for vertical orientation
        .attr("y", 0 + margin.left) // Position to the left of the y-axis
        .attr("x", 0 + margin.left*6) // Position at the middle of the y-axis
        .attr("dy", "1em") // Adjustments for alignment
        .style("text-anchor", "left") // Centers the text
        .text("agreement") // Text of the label
        .style("font-family", "Source Sans Pro"); // Set the font


        // ... Force simulation setup ...

        const simulation = d3.forceSimulation(data.value)
            .force('y', d3.forceY(d => yScale(d.level_agreement)).strength(1))
            .force('x', d3.forceX(width / 2))
            .force('collide', d3.forceCollide(d => radiusScale(d.evidence_val)))
            .stop();

        simulation.tick(120);

        svg.selectAll('circle')
            .data(data.value)
            .enter()
            .append('circle')
            .attr('cx', d => Math.max(radius, Math.min(width - radius, d.x))) // Constrain within bounds
    .attr('cy', d => Math.max(radius, Math.min(height - radius, d.y))) // Constrain within bounds
    
            .attr('r', d => radiusScale(d.evidence_val))
            .style('fill',  d => colorScale(d.dimension))
            .attr('color', 'white');
}

</script>
  
<style scoped lang="scss">

#chart-container {
    text-align: center;
}
#chart-container svg {
    max-width: 100%;
    max-height: 100%;
    height: auto; /* Maintain aspect ratio */
    display: inline-block;
}

</style>

<style lang="scss">
   
    .chart-text {
        user-select: none;
    }


</style>
  