# source('1_fetch/src/file_utils.R')
# source('2_process/src/spatial_utils.R')
# source('2_process/src/data_utils.R')

p2_targets <- list(
  # Confirming raw data matches `p1_unc_stats` from SB
  tar_target(p2_unc_agg_summary,
             p1_unc_agg |> 
               group_by(dimension, determinant, indicator) |> 
               summarize(
                 total_positively_related = sum(positively_related, na.rm = TRUE),
                 total_negatively_related = sum(negatively_related, na.rm = TRUE),
                 total_unrelated = sum(unrelated, na.rm = TRUE),
                 total_unknown_direction = sum(unknown_direction, na.rm = TRUE),
                 total_significant = sum(significant, na.rm = TRUE),
                 total_not_significant = sum(not_significant, na.rm = TRUE),
                 total_unknown = sum(unknown, na.rm = TRUE))
             ),
  # Based on metadata:
  # Amt of evidence: Small = total_studies < 5; Medium = total_studies 5-9; Large,total_studies = > 9
  # Amt of agreement: Low = < 50% of models; Medium = >50% & <74% of models; High = >74% of models; NA if the level of agreement could not be calculated as indicator was measured only once.
  tar_target(p2_agree_evid_stats,
             p1_unc_stats |>
               mutate(
                 evidence_val = pos_related + neg_related + unrelated + unk_direction,
                 # lots of mismatched ordinal vs cardinal values for agreement
                 agreement_val = (pos_related / (sig_strength + not_sig_strength + unk_strength) * 100))
               )
  )